<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat√°logo Pro - Control AI Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
        ========================================================================
        1. SECCI√ìN DE ESTILOS (CSS)
        Contiene todo el dise√±o visual, animaciones y adaptabilidad m√≥vil.
        ========================================================================
    -->
    <style>
        /* Base y Tipograf√≠a */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            scroll-behavior: smooth; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
            overflow-x: hidden; 
        }
        
        /* Temas Din√°micos */
        .winter-theme { background: linear-gradient(180deg, #1e3a8a 0%, #2563eb 100%); }
        .summer-theme { background: linear-gradient(180deg, #c2410c 0%, #f97316 100%); }
        
        /* Utilidades de Scroll y Texto */
        .scroll-hide::-webkit-scrollbar { display: none; }
        .scroll-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* Estilos del Modo Edici√≥n */
        .edit-mode .editable {
            -webkit-user-select: text !important; 
            user-select: text !important; 
            cursor: text;
            border-bottom: 2px dashed rgba(255,255,255,0.4);
        }
        .edit-mode #mainContent .editable { border-bottom: 1px dashed #cbd5e1; }
        .edit-mode .editable:focus, .edit-mode .editable:hover {
            outline: none; 
            background-color: #fef08a !important; 
            color: #1e293b !important; 
            border-radius: 4px;
        }
        .view-mode .admin-only { display: none !important; }

        /* Controles de Tama√±o de Fuente (Modo Texto) */
        .size-control {
            position: absolute; top: -45px; left: 50%; transform: translateX(-50%);
            background: white; border: 1px solid #cbd5e1; border-radius: 8px;
            display: none; align-items: center; padding: 4px; gap: 2px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.15); z-index: 5000;
        }
        .text-edit-active .size-control { display: flex; }
        .size-btn {
            width: 26px; height: 26px; display: flex; align-items: center; justify-content: center;
            background: #f1f5f9; border-radius: 4px; cursor: pointer; font-size: 10px; color: #334155; font-weight: bold;
        }
        .size-btn:active { transform: scale(0.95); }
        .size-btn.reset { color: #2563eb; background: #eff6ff; }
        .size-input { width: 30px; text-align: center; font-size: 12px; font-weight: 800; border: none; outline: none; background: transparent; }

        /* Badge de Descuento */
        .discount-badge {
            position: absolute; top: 0; right: 0; background: #dc2626; color: white;
            font-weight: 900; padding: 4px 10px; border-bottom-left-radius: 12px;
            font-size: 0.8rem; z-index: 20; box-shadow: -1px 1px 4px rgba(0,0,0,0.2);
        }

        /* Sistema de Modales */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            display: none; align-items: center; justify-content: center; 
            z-index: 9999; backdrop-filter: blur(5px); 
        }
        .modal-overlay.active { display: flex; }
        .modal-window { 
            background: white; width: 95%; max-width: 400px; padding: 25px; 
            border-radius: 24px; max-height: 90vh; overflow-y: auto; 
        }

        /* Animaciones */
        .logo-active { animation: logoPress 0.2s ease; }
        @keyframes logoPress { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }

        /* Estilos IA ‚ú® */
        .ai-sparkle { 
            background: linear-gradient(90deg, #6366f1, #a855f7); 
            color: white; border-radius: 8px; padding: 4px 8px; 
            font-size: 10px; font-weight: bold; cursor: pointer; 
            display: inline-flex; align-items: center; gap: 4px; transition: all 0.2s; border: none; 
        }
        .ai-sparkle:hover { transform: scale(1.05); opacity: 0.9; }
        .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>

<!-- 
    ========================================================================
    2. SECCI√ìN DE ESTRUCTURA (HTML)
    Define los elementos de la p√°gina, men√∫s y ventanas emergentes.
    ========================================================================
-->
<body id="bodyTag" class="h-full view-mode">

    <!-- BARRA DE ADMINISTRACI√ìN (Se activa tras 5 clics en el logo) -->
    <div id="adminPanel" class="fixed top-0 left-0 right-0 z-[4000] bg-gray-950 text-white p-2 hidden flex-col md:flex-row justify-between items-center shadow-2xl border-b border-white/10">
        <div class="flex items-center gap-2 flex-wrap justify-center w-full">
            <button onclick="toggleViewMode()" id="modeBtn" class="bg-blue-600 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">üëÅÔ∏è Modo Cliente</button>
            <button onclick="toggleTextMode()" id="textBtn" class="bg-indigo-600 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">üìù Ajustar Textos</button>
            <button onclick="openWhatsappConfig()" class="bg-green-700 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">üìû WhatsApp</button>
            <button onclick="saveToStorage()" class="bg-indigo-600 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">üíæ Guardar Todo</button>
            <button onclick="closeAdminPanel()" class="bg-red-600 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">‚ùå Salir</button>
        </div>
    </div>

    <!-- CABECERA PRINCIPAL -->
    <header id="mainHeader" class="text-center pt-8 pb-10 winter-theme text-white relative rounded-b-[3rem] shadow-xl transition-all duration-500">
        <div id="logoContainer" class="w-20 h-20 md:w-28 md:h-28 mx-auto mb-2 bg-white rounded-full p-1 shadow-inner overflow-hidden relative cursor-pointer" onclick="handleLogoSecret()">
            <img id="storeLogo" src="https://via.placeholder.com/200?text=LOGO" class="w-full h-full object-contain rounded-full">
            <div class="admin-only absolute inset-0 bg-black/50 flex items-center justify-center text-[10px] font-bold opacity-0 hover:opacity-100 transition-opacity uppercase text-white">Editar Logo</div>
        </div>
        
        <div class="relative-text inline-block px-4 max-w-full">
            <h1 id="storeTitle" class="font-black uppercase leading-none mb-1 tracking-tighter whitespace-nowrap">CAT√ÅLOGO PRO</h1>
            <div class="size-control admin-only" id="ctrl-title"></div>
        </div>
        <br>
        <div class="relative-text inline-block px-4 group">
            <p id="storeSubtitle" class="opacity-90 italic">Calidad superior para tu hogar</p>
            <div class="size-control admin-only" id="ctrl-subtitle"></div>
            <!-- Bot√≥n IA -->
            <div class="admin-only absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity">
                <button id="aiSloganBtn" onclick="generateAISlogan()" class="ai-sparkle">‚ú® Slogan AI</button>
            </div>
        </div>
    </header>

    <!-- SELECTOR DE TEMPORADA -->
    <div class="flex justify-center -mt-6 relative z-10 px-4">
        <div class="bg-white/95 backdrop-blur-md p-1 rounded-full shadow-lg flex gap-1 w-full max-w-lg border border-white">
            <button onclick="switchSeason('winter')" id="btnWinter" class="flex-1 py-3 rounded-full text-sm font-black transition-all uppercase">‚ùÑÔ∏è Invierno</button>
            <button onclick="switchSeason('summer')" id="btnSummer" class="flex-1 py-3 rounded-full text-sm font-black transition-all uppercase">‚òÄÔ∏è Verano</button>
        </div>
    </div>

    <!-- MEN√ö DE NAVEGACI√ìN POR CATEGOR√çAS -->
    <nav class="sticky top-0 z-40 bg-white/95 backdrop-blur-md mt-4 border-b border-gray-100 shadow-sm">
        <div class="nav-container scroll-hide overflow-x-auto whitespace-nowrap py-2">
            <div id="circleNav" class="flex gap-4 px-4"></div>
        </div>
    </nav>

    <!-- √ÅREA DE PRODUCTOS -->
    <main id="mainContent" class="px-2 py-4 space-y-8 pb-40 max-w-full overflow-hidden"></main>

    <!-- BOT√ìN A√ëADIR (ADMIN) -->
    <div class="fixed bottom-6 right-4 admin-only z-30 pointer-events-none">
        <button onclick="addCategory()" class="pointer-events-auto bg-indigo-600 text-white w-14 h-14 rounded-full shadow-2xl text-4xl font-bold border-4 border-white active:scale-90">+</button>
    </div>

    <!-- MODALES DE AJUSTES -->
    <div id="whatsappModal" class="modal-overlay">
        <div class="modal-window text-center">
            <h3 class="text-lg font-black text-gray-800 mb-4 uppercase">üìû CONFIGURACI√ìN WHATSAPP</h3>
            <input type="text" id="wsNumber" class="w-full border p-3 text-sm bg-gray-50 rounded-xl mb-3" placeholder="N√∫mero (ej: 51900000000)">
            <input type="text" id="wsText" class="w-full border p-3 text-sm bg-gray-50 rounded-xl mb-3" placeholder="Texto del bot√≥n">
            <div class="flex items-center justify-between px-2 mb-6">
                <span class="text-[10px] font-bold text-gray-400 uppercase">Color bot√≥n:</span>
                <input type="color" id="wsColor" class="w-12 h-10 border-none bg-transparent">
            </div>
            <div class="flex gap-2">
                <button onclick="document.getElementById('whatsappModal').classList.remove('active')" class="flex-1 bg-gray-100 py-3 rounded-xl font-bold text-xs uppercase">Cerrar</button>
                <button onclick="saveWhatsappConfig()" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold text-xs uppercase">Guardar</button>
            </div>
        </div>
    </div>

    <div id="editProductModal" class="modal-overlay">
        <div class="modal-window">
            <h3 class="text-lg font-black text-gray-800 mb-4 uppercase text-center">üì¶ FICHA PRODUCTO</h3>
            <div class="space-y-4">
                <input type="text" id="prodThumb" class="w-full border p-3 text-xs rounded-xl" placeholder="URL Imagen Miniatura">
                <input type="number" id="prodDiscount" class="w-full border p-3 text-xs rounded-xl" placeholder="% Descuento">
                <div class="border-t pt-2">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-[10px] font-bold text-gray-400 uppercase">Descripci√≥n</label>
                        <button onclick="generateAIDesc()" class="ai-sparkle">‚ú® Crear con IA</button>
                    </div>
                    <textarea id="prodDescText" class="w-full border p-3 text-xs rounded-xl h-24 resize-none" placeholder="Escribe aqu√≠..."></textarea>
                </div>
            </div>
            <div class="flex gap-2 mt-6">
                <button onclick="document.getElementById('editProductModal').classList.remove('active')" class="flex-1 bg-gray-100 py-3 text-xs font-bold uppercase rounded-xl">Cerrar</button>
                <button onclick="saveProductModalChanges()" class="flex-1 bg-indigo-600 text-white py-3 text-xs font-bold uppercase rounded-xl">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- MODALES DE NOTIFICACI√ìN -->
    <div id="alertModal" class="modal-overlay" style="z-index: 99999;">
        <div class="modal-window text-center">
            <div id="alertIcon" class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">i</div>
            <h3 id="alertTitle" class="text-xl font-black text-gray-800 mb-2 uppercase">Aviso</h3>
            <p id="alertBody" class="text-xs text-gray-500 mb-6"></p>
            <button onclick="document.getElementById('alertModal').classList.remove('active')" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold text-xs uppercase">Aceptar</button>
        </div>
    </div>

    <!-- ZOOM DE IMAGEN -->
    <div id="imageModal" class="modal-overlay">
        <button onclick="document.getElementById('imageModal').classList.remove('active')" class="absolute top-4 right-4 text-white text-3xl">‚úï</button>
        <img id="modalImg" src="" class="max-w-[95%] max-h-[90vh] rounded-xl shadow-2xl">
    </div>

    <!-- 
        ========================================================================
        3. SECCI√ìN DE L√ìGICA (JAVASCRIPT)
        Maneja la base de datos, los cambios de modo, el renderizado y la IA.
        ========================================================================
    -->
    <script>
        // --- VARIABLES DE ESTADO Y CONFIGURACI√ìN ---
        const apiKey = ""; // La IA usa el motor del sistema
        let isEditMode = false;
        let isAdminActive = false;
        let isTextMode = false;
        let currentEdit = { cIdx: null, pIdx: null };
        let logoClicks = 0;
        let clickTimer = null;

        const DEFAULTS = { titleSize: 24, subtitleSize: 14, nameSize: 16, descSize: 11, priceSize: 22, catNameSize: 10 };

        let state = {
            season: 'winter', 
            whatsapp: '11133344', 
            wsText: 'Comprar por WhatsApp', 
            wsColor: '#25D366',
            logo: 'https://cdn-icons-png.flaticon.com/512/6103/6103079.png', 
            title: 'EDREDONES PREMIUM',
            titleSize: DEFAULTS.titleSize, 
            subtitle: 'Calidad superior y confort para tu descanso', 
            subtitleSize: DEFAULTS.subtitleSize,
            winter: [], 
            summer: []
        };

        // --- SISTEMA DE ALERTAS PERSONALIZADO ---
        function showAlert(msg, title = "Aviso") {
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertBody').innerText = msg;
            document.getElementById('alertModal').classList.add('active');
        }

        // --- MOTOR DE INTELIGENCIA ARTIFICIAL (GEMINI) ---
        async function callGemini(prompt, systemPrompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };
            
            const delays = [1000, 2000, 4000, 8000, 16000];
            for (let i = 0; i < delays.length; i++) {
                try {
                    const res = await fetch(url, { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'application/json' } });
                    if (!res.ok) throw new Error();
                    const json = await res.json();
                    return json.candidates?.[0]?.content?.parts?.[0]?.text || "";
                } catch (e) {
                    if (i === delays.length - 1) return "Error de red.";
                    await new Promise(r => setTimeout(r, delays[i]));
                }
            }
        }

        async function generateAISlogan() {
            const btn = document.getElementById('aiSloganBtn');
            btn.disabled = true;
            btn.innerHTML = `‚ú® Creando...`;
            const sys = "Eres un experto en marketing de lujo para art√≠culos de cama.";
            const prompt = `Crea un slogan elegante de 6 palabras para edredones. Temporada: ${state.season}. Solo el texto.`;
            const result = await callGemini(prompt, sys);
            if (result && !result.includes("Error")) {
                state.subtitle = result.replace(/"/g, '').trim();
                render();
            }
            btn.disabled = false; btn.innerHTML = `‚ú® Slogan AI`;
        }

        async function generateAIDesc() {
            const p = state[state.season][currentEdit.cIdx].products[currentEdit.pIdx];
            if (!p.name || p.name === "Producto") return showAlert("Primero pon un nombre al producto.");
            const prompt = `Escribe una descripci√≥n de 15 palabras para "${p.name}". Enf√≥cate en suavidad y lujo. Solo texto.`;
            const result = await callGemini(prompt, "Redactor de productos.");
            if (result) { document.getElementById('prodDescText').value = result.trim(); }
        }

        // --- FUNCIONES DEL CATALOGO ---
        function init() {
            const saved = localStorage.getItem('catalogo_v3_optimized');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            } else {
                state.winter = [{ id: 1, name: "NUEVA COLECCI√ìN", icon: state.logo, nameSize: 10, products: [
                    { name: "Edred√≥n Luxury", nameSize: 16, description: "Textura ultra suave y t√©rmica.", descSize: 11, price: "S/ 199", priceSize: 22, hasDiscount: true, discountValue: 10, thumb: "https://via.placeholder.com/400x500/1e3a8a/fff?text=EDREDON", zoom: "" }
                ]}];
            }
            render();
        }

        function handleLogoSecret() {
            logoClicks++;
            clearTimeout(clickTimer);
            if (logoClicks >= 5) { logoClicks = 0; enterAdminMode(); }
            else { clickTimer = setTimeout(() => logoClicks = 0, 2000); }
        }

        function enterAdminMode() { 
            isAdminActive = true; isEditMode = true; 
            document.getElementById('adminPanel').classList.replace('hidden', 'flex'); 
            document.getElementById('bodyTag').className = 'h-full edit-mode'; 
            render(); 
        }

        function closeAdminPanel() { 
            isAdminActive = isEditMode = isTextMode = false;
            document.getElementById('adminPanel').classList.replace('flex', 'hidden');
            document.getElementById('bodyTag').className = 'h-full view-mode';
            render();
        }

        function toggleViewMode() { 
            isEditMode = !isEditMode;
            document.getElementById('modeBtn').innerText = isEditMode ? 'üëÅÔ∏è Modo Cliente' : 'üõ†Ô∏è Modo Editor';
            document.getElementById('bodyTag').className = isEditMode ? 'h-full edit-mode' : 'h-full view-mode';
            render();
        }

        function toggleTextMode() {
            isTextMode = !isTextMode;
            document.getElementById('bodyTag').classList.toggle('text-edit-active', isTextMode);
        }

        function updateSize(type, cIdx, pIdx, key, val) {
            val = Math.max(1, 100, val);
            if (type === 'global') state[key] = val;
            else if (type === 'cat') state[state.season][cIdx][key] = val;
            else if (type === 'prod') state[state.season][cIdx].products[pIdx][key] = val;
            render();
        }

        function renderSizeControl(currentVal, type, cIdx, pIdx, key, def) {
            const args = `'${type}', ${cIdx}, ${pIdx}, '${key}'`;
            return `<div class="size-btn" onclick="updateSize(${args}, ${currentVal - 1})">‚ñº</div>
                    <input type="number" class="size-input" value="${currentVal}" onchange="updateSize(${args}, parseInt(this.value))">
                    <div class="size-btn" onclick="updateSize(${args}, ${currentVal + 1})">‚ñ≤</div>
                    <div class="size-btn reset" onclick="updateSize(${args}, ${def})">‚Ü∫</div>`;
        }

        function render() {
            const isW = state.season === 'winter';
            const data = state[state.season];
            
            // Render Header
            document.getElementById('mainHeader').className = `text-center pt-8 pb-10 winter-theme text-white relative rounded-b-[3rem] shadow-xl transition-all ${isW ? 'winter-theme' : 'summer-theme'}`;
            document.getElementById('storeLogo').src = state.logo;
            
            const title = document.getElementById('storeTitle');
            title.innerText = state.title; title.style.fontSize = state.titleSize + 'px';
            title.contentEditable = isEditMode;
            title.onblur = (e) => state.title = e.target.innerText;
            document.getElementById('ctrl-title').innerHTML = renderSizeControl(state.titleSize, 'global', 0, 0, 'titleSize', DEFAULTS.titleSize);

            const subtitle = document.getElementById('storeSubtitle');
            subtitle.innerText = state.subtitle; subtitle.style.fontSize = state.subtitleSize + 'px';
            subtitle.contentEditable = isEditMode;
            subtitle.onblur = (e) => state.subtitle = e.target.innerText;
            document.getElementById('ctrl-subtitle').innerHTML = renderSizeControl(state.subtitleSize, 'global', 0, 0, 'subtitleSize', DEFAULTS.subtitleSize);

            // Render Nav
            document.getElementById('circleNav').innerHTML = data.map((cat, idx) => `
                <div class="flex flex-col items-center gap-2 cursor-pointer min-w-[5.5rem] shrink-0" onclick="scrollToSection(${idx})">
                    <div class="relative w-16 h-16 rounded-full border-2 border-white bg-white shadow overflow-hidden">
                        <img src="${cat.icon}" class="w-full h-full object-cover">
                    </div>
                    <span style="font-size: ${cat.nameSize}px" class="font-black text-gray-700 uppercase editable">${cat.name}</span>
                </div>`).join('');

            // Render Content
            document.getElementById('mainContent').innerHTML = data.map((cat, cIdx) => `
                <section id="cat-${cIdx}" class="bg-white rounded-[24px] shadow-sm mb-8 overflow-hidden">
                    <div class="flex justify-between items-center px-4 pt-4 border-b border-gray-50 pb-2 mb-4">
                        <h2 class="text-xl font-black text-gray-800 uppercase border-b-4 ${isW ? 'border-blue-600' : 'border-orange-600'}">${cat.name}</h2>
                        <div class="admin-only flex gap-1">
                            <button onclick="deleteAction('cat', ${cIdx})" class="text-[8px] bg-red-50 text-red-600 px-2 py-1 rounded-lg font-black">BORRAR</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 pb-4 px-1">
                        ${cat.products.map((p, pIdx) => `
                        <div class="product-card bg-white border border-gray-100 rounded-xl overflow-hidden flex flex-col h-full">
                            <div class="aspect-[4/5] bg-gray-50 relative overflow-hidden">
                                <img src="${p.thumb}" loading="lazy" class="w-full h-full object-cover cursor-zoom-in" onclick="openZoom('${p.thumb}')">
                                ${p.hasDiscount ? `<div class="discount-badge">-${p.discountValue}%</div>` : ''}
                                <div class="admin-only absolute inset-0 bg-black/50 flex flex-col items-center justify-center gap-2 opacity-0 hover:opacity-100 transition-all p-2">
                                    <button onclick="openEditProductModal(${cIdx}, ${pIdx})" class="w-full bg-white text-[9px] font-black py-2 rounded-lg uppercase">Configurar</button>
                                </div>
                            </div>
                            <div class="p-2 flex flex-col flex-1">
                                <h4 contenteditable="${isEditMode}" onblur="updateProd(${cIdx}, ${pIdx}, 'name', this.innerText)" style="font-size: ${p.nameSize}px" class="font-black text-gray-800 editable">${p.name}</h4>
                                <p contenteditable="${isEditMode}" onblur="updateProd(${cIdx}, ${pIdx}, 'description', this.innerText)" style="font-size: ${p.descSize}px" class="text-gray-400 leading-tight mb-2 editable">${p.description}</p>
                                <div class="mt-auto">
                                    <p class="text-blue-600 font-black text-lg">${p.hasDiscount ? calculateDiscount(p.price, p.discountValue) : p.price}</p>
                                    <button onclick="sendWhatsapp(${cIdx}, ${pIdx})" style="background-color: ${state.wsColor}" class="w-full py-3 text-white font-bold text-[10px] rounded-xl uppercase mt-2">${state.wsText}</button>
                                </div>
                            </div>
                        </div>`).join('')}
                        <div onclick="addProduct(${cIdx})" class="admin-only aspect-[4/5] flex items-center justify-center text-gray-300 cursor-pointer text-4xl hover:bg-gray-100 bg-white rounded-xl border-2 border-dashed border-gray-100">+</div>
                    </div>
                </section>`).join('');

            updateSeasonButtons();
        }

        function updateSeasonButtons() {
            const isW = state.season === 'winter';
            document.getElementById('btnWinter').className = `flex-1 py-3 rounded-full text-sm font-black transition-all ${isW ? 'winter-theme text-white shadow' : 'bg-gray-100 text-gray-400'}`;
            document.getElementById('btnSummer').className = `flex-1 py-3 rounded-full text-sm font-black transition-all ${!isW ? 'summer-theme text-white shadow' : 'bg-gray-100 text-gray-400'}`;
        }

        // --- MANEJO DE CONFIGURACIONES ---
        function saveToStorage() { localStorage.setItem('catalogo_v3_optimized', JSON.stringify(state)); showAlert("Cambios guardados correctamente."); }
        function openWhatsappConfig() { document.getElementById('wsNumber').value = state.whatsapp; document.getElementById('wsColor').value = state.wsColor; document.getElementById('whatsappModal').classList.add('active'); }
        function saveWhatsappConfig() { state.whatsapp = document.getElementById('wsNumber').value; state.wsText = document.getElementById('wsText').value; state.wsColor = document.getElementById('wsColor').value; render(); document.getElementById('whatsappModal').classList.remove('active'); }
        function openEditProductModal(c, p) { currentEdit = { cIdx: c, pIdx: p }; const prod = state[state.season][c].products[p]; document.getElementById('prodThumb').value = prod.thumb; document.getElementById('prodDiscount').value = prod.discountValue; document.getElementById('prodDescText').value = prod.description; document.getElementById('editProductModal').classList.add('active'); }
        function saveProductModalChanges() { const prod = state[state.season][currentEdit.cIdx].products[currentEdit.pIdx]; prod.thumb = document.getElementById('prodThumb').value; prod.discountValue = parseInt(document.getElementById('prodDiscount').value); prod.description = document.getElementById('prodDescText').value; render(); document.getElementById('editProductModal').classList.remove('active'); }
        function switchSeason(s) { state.season = s; render(); }
        function addCategory() { state[state.season].push({ id: Date.now(), name: "NUEVA", icon: state.logo, nameSize: 10, products: [] }); render(); }
        function addProduct(i) { state[state.season][i].products.push({ name: "Producto", nameSize: 16, description: "...", descSize: 11, price: "S/ 100", hasDiscount: false, discountValue: 0, thumb: "https://via.placeholder.com/400x500", zoom: "" }); render(); }
        function deleteAction(t, c) { if(confirm("¬øSeguro?")) { state[state.season].splice(c, 1); render(); } }
        function updateProd(c, p, k, v) { state[state.season][c].products[p][k] = v; }
        function calculateDiscount(p, d) { let n = parseFloat(p.replace(/[^0-9.]/g, '')); return "S/ " + (n * (100 - d) / 100).toFixed(0); }
        function openZoom(u) { document.getElementById('modalImg').src = u; document.getElementById('imageModal').classList.add('active'); }
        function scrollToSection(i) { const el = document.getElementById(`cat-${i}`); if(el) window.scrollTo({top: el.offsetTop - 70, behavior: 'smooth'}); }
        function sendWhatsapp(c, p) { const prod = state[state.season][c].products[p]; const price = prod.hasDiscount ? calculateDiscount(prod.price, prod.discountValue) : prod.price; const text = `Hola, me interesa el producto: ${prod.name.toUpperCase()}\nPrecio: ${price}\nImagen: ${prod.thumb}`; window.open(`https://wa.me/${state.whatsapp}?text=${encodeURIComponent(text)}`, '_blank'); }

        window.onload = init;
    </script>
</body>
</html>